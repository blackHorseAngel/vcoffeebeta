<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>更新用户页面</title>
    <link rel="stylesheet" type="text/css" href="/css/pure-min.css"/>
    <script type="text/javascript">
        /**
         * 单选框选中一个自动取消另一个
         */
    function chooseAdmin() {
        let isNotAdmin = document.getElementById("isNotAdmin");
        let isAdmin = document.getElementById("isAdmin");
        console.log("isNotAdmin的checked属性值：" + isNotAdmin.checked);
        console.log("isAdmin的checked属性值：" + isAdmin.checked);
        if(isAdmin.checked === true){
            isNotAdmin.checked = false;
        }
    }

        /**
         * 单选框选中一个自动取消另一个
         */
    function chooseNotAdmin() {
        let isNotAdmin = document.getElementById("isNotAdmin");
        let isAdmin = document.getElementById("isAdmin");
        console.log("isNotAdmin的checked属性值：" + isNotAdmin.checked);
        console.log("isAdmin的checked属性值：" + isAdmin.checked);
        if(isNotAdmin.checked === true){
            isAdmin.checked = false;
        }
    }

        /**
         * 页面初始化，获取当前用户的全部信息并展示在页面上
         */
    window.onload = function () {
      let id = location.search.replace(/[^\d]/g,"");
      const updateParam = {
        "id":id
      };
      const url = "/vcoffee/user/toUpdateUser";
      const xhr = new XMLHttpRequest();
      xhr.open("POST",url,true);
      xhr.setRequestHeader("content-Type","application/json");
      xhr.onload = function () {
        let res = JSON.parse(xhr.responseText);
        if(res.code === 1000){
            console.log(res.message);
            document.getElementById("userName").value = res.data.username;
            document.getElementById("telephoneNumber").value = res.data.telephoneNumber;
            document.getElementById("email").value = res.data.email;
            let isAdmin = document.getElementById("isAdmin");
            let isNotAdmin = document.getElementById("isNotAdmin");
            if(res.data.isAdmin === 1){
                isAdmin.checked = true;
            }else if(res.data.isAdmin === 0){
                isNotAdmin.checked = true;
            }
        }else{
            console.error("初始化更新用户页面报错，" + res.message);
            window.location.href = "/error/error.html";
        }
      };
      xhr.onerror = function () {
          console.error("初始化更新用户页面报错，" + JSON.parse(xhr.responseText).message);
          window.location.href = "/error/error.html";
      };
      xhr.send(JSON.stringify(updateParam));
    };

        /**
         * 更新用户前，获取更改后的单选框的值
         * @returns {*}
         */
    function getIsAdminRadioValue(){
        let isAdmin = document.getElementById("isAdmin");
        let isNotAdmin = document.getElementById("isNotAdmin");
        let isAdminValue = null;
        let isNotAdminValue = null;
        if(isAdmin.checked === true){
            isAdminValue = isAdmin.value;
            return isAdminValue;
        }
        if(isNotAdmin.checked === true){
            isNotAdminValue = isNotAdmin.value;
            return isNotAdminValue;
        }
    }

        /**
         * 点击更新按钮，更新用户信息
         */
    function updateUser() {
      const userName = document.getElementById("userName").value;
      const telephoneNumber = document.getElementById("telephoneNumber").value;
      const email = document.getElementById("email").value;
      const isAdmin = getIsAdminRadioValue();
      const updateParams = {
        "username":userName,
        "telephoneNumber":telephoneNumber,
        "email":email,
        "isAdmin":isAdmin
      };
      const url = "/vcoffee/user/updateUser";
      const xhr = new XMLHttpRequest();
      xhr.open("POST",url,true);
      xhr.setRequestHeader("content-Type","application/json");
      xhr.onload = function () {
        let res = JSON.parse(xhr.responseText);
        if(res.code === 1000){
            console.log(res.message);
            window.location.href = "/user/queryUser.html";
        }else{
            console.error("修改用户信息报错" + res.message);
            window.location.href = "/error/error.html";
        }
      };
      xhr.onerror = function () {
        console.error("修改用户信息失败" + JSON.parse(xhr.responseText).message);
        window.location.href = "/error/error.html";
      };
      xhr.send(JSON.stringify(updateParams));
    }

        /**
         * 返回主页面
         */
    function back() {
      window.location.href = "/home/home.html";
    }
    </script>
</head>
<body>
  <form class="pure-form pure-form-aligned" method="post">
      <div class="pure-controls">
          <legend align="center">更新用户</legend>
      </div>
      <div class="pure-control-group" align="center">
          <label for="userName">用户名称</label>
          <input type="text" id="userName" name="userName" placeholder="用户名称"/>
      </div>
      <div class="pure-control-group" align="center">
          <label for="telephoneNumber">用户电话</label>
          <input type="number" id="telephoneNumber" name="telephoneNumber" placeholder="用户电话"/>
      </div>
      <div class="pure-control-group" align="center">
          <label for="email">用户邮箱</label>
          <input type="email" id="email" name="email" placeholder="用户邮箱"/>
      </div>
      <div class="pure-control-group" align="center">
          <label for="isAdmin">管理员权限</label>
          <input type="radio" id="isAdmin" name="isAdmin" value="1" onclick="chooseAdmin()"/>一般管理员
          <input type="radio" id="isNotAdmin" name="isNotAdmin" value="0" onclick="chooseNotAdmin()"/>普通员工
      </div>
      <div class="pure-control-group" align="center">
          <button type="button" class="pure-button pure-button-primary" onclick="updateUser()">更新</button>
          <button type="reset"class="pure-button pure-button-primary">取消</button>
          <button type="button" class="pure-button pure-button-primary" onclick="back()">返回</button>
      </div>
  </form>
</body>
</html>