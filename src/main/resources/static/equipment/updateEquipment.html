<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>修改设备页面</title>
    <link rel="stylesheet" type="text/css" href="/css/pure-min.css">
    <script type="text/javascript">
        /**
         * 单选框选中一个自动取消选定另一个
         */
    function chooseUsed() {
        let isNotUsed = document.getElementById("isNotUsed");
        let isUsed = document.getElementById("isUsed");
        alert("isUsed的checked属性值是： " + isUsed.checked);
        alert("isNotUsed的checked属性值：" + isNotUsed.checked);
        if(isUsed.checked === true){
            isNotUsed.checked = false;
        }
    }
        /**
         * 单选框选中一个自动取消选定另一个
         */
    function chooseNotUsed() {
        let isNotUsed = document.getElementById("isNotUsed");
        let isUsed = document.getElementById("isUsed");
        alert("isNotUsed的属性值是： " + isNotUsed.checked);
        alert("isUsed的属性值是：" + isUsed.checked);
        if(isNotUsed.checked === true){
            isUsed.checked = false;
        }
    }

        /**
         * 页面初始化，获取当前设备信息并展示在页面上
         */
    window.onload = function () {
            let id = location.search.replace(/[^\d]/g,"");
            const updateParam = {
                "id":id
            };
            const url = "/vcoffee/equipment/toUpdateEquipment";
            const xhr = new XMLHttpRequest();
            xhr.open("POST",url,true);
            xhr.setRequestHeader("content-Type","application/json");
            xhr.onload = function () {
                let res = JSON.parse(xhr.responseText);
                if(res.code === 1000){
                    alert(res.message);
                    document.getElementById("serialNumber").value = res.data.serialNumber;
                    document.getElementById("equipmentName").value = res.data.equipmentName;
                    let isNotUsedRatio = document.getElementById("isNotUsed");
                    let isUsedRatio = document.getElementById("isUsed");
                    if(res.data.isUsed === 0){
                        isNotUsedRatio.checked = true;
                    }else if(res.data.isUsed === 1){
                        isUsedRatio.checked = true;
                    }
                    document.getElementById("attendantName").value = res.data.attendantName;
                    document.getElementById("attendantTelephoneNumber").value = res.data.attendantTelephoneNumber;
                }else{
                    console.error("初始化更新设备页面报错" + res.message);
                    window.location.href = "/error/error.html";
                }
            };
            xhr.onerror = function () {
                console.error("初始化更新设备页面报错， " + JSON.parse(xhr.responseText).message);
                window.location.href = "/error/error.html";
            };
            xhr.send(JSON.stringify(updateParam));
        };

        /**
         * 获取单选框的值
         * @returns {*}
         */
    function getIsUsedRadioValue(){
        let isUsed = document.getElementById("isUsed");
        let isNotUsed = document.getElementById("isNotUsed");
        let isUsedValue = null;
        let isNotUsedValue = null;
        if(isUsed.checked === true){
            isUsedValue = isUsed.value;
            return isUsedValue;
        }
        if(isNotUsed.checked === true){
            isNotUsedValue = isNotUsed.value;
            return isNotUsedValue;
        }
    }

        /**
         * 点击更新按钮，更新设备信息
         */
        function updateEquipment() {
            const serialNumber = document.getElementById("serialNumber").value;
            const equipmentName = document.getElementById("equipmentName").value;
            const isUsed = getIsUsedRadioValue();
            const attendantName = document.getElementById("attendantName").value;
            const attendantTelephoneNumber = document.getElementById("attendantTelephoneNumber").value;
            const updateParams = {
              "serialNumber":serialNumber,
              "equipmentName":equipmentName,
              "isUsed":isUsed,
              "attendantName":attendantName,
              "attendantTelephoneNumber":attendantTelephoneNumber
            };
            const url = "/vcoffee/equipment/updateEquipment";
            const xhr = new XMLHttpRequest();
            xhr.open("POST",url,true);
            xhr.setRequestHeader("content-Type","application/json");
            xhr.onload = function (e1) {
                let res = JSON.parse(xhr.responseText);
                if(res.code === 1000){
                    alert(res.message);
                    window.location.href = "/equipment/queryEquipment.html";
                }else{
                    console.error("修改设备信息失败" + res.message);
                    window.location.href = "/error/error.html";
                }
            };
            xhr.onerror = function (e2) {
                console.error("修改设备信息失败" + JSON.parse(xhr.responseText).message);
                window.location.href = "/error/error.html";
            };
            xhr.send(JSON.stringify(updateParams));
        }

        /**
         * 返回主页面
         */
        function back() {
            window.location.href = "/home/home/html";
        }

    </script>
</head>
<body background="/picture/welcome.jpg" style="background-repeat: no-repeat;background-size: 100% 100%;background-attachment: fixed;">
    <form method="post" class="pure-form pure-form-aligned">
        <fieldset>
            <div class="pure-controls">
                <legend align="center">修改设备</legend>
            </div>
            <div class="pure-control-group" align="center">
                <label for="serialNumber">设备序列号</label>
                <input type="text" id="serialNumber" name="serialNumber" placeholder="设备序列号" size="32"/>
            </div>
            <div class="pure-control-group" align="center">
                <label for="equipmentName">设备名称</label>
                <input type="text" id="equipmentName" name="equipmentName" placeholder="设备名称" size="20"/>
            </div>
            <div class="pure-control-group" align="center">
                <label for="isUsed">是否投入使用</label>
                <input type="radio" id="isNotUsed" name="isNotUsed"value="0" onclick="chooseNotUsed()"/>未投入
                <input type="radio" id="isUsed" name="isUsed" value="1" onclick="chooseUsed()"/>已投入
            </div>
            <div class="pure-control-group" align="center">
                <label for="attendantName">维护人姓名</label>
                <input type="text" id="attendantName" name="attendantName" size="12"/>
            </div>
            <div class="pure-control-group" align="center">
                <label for="attendantTelephoneNumber">维护人联系方式</label>
                <input type="number" id="attendantTelephoneNumber" name="attendantTelephoneNumber" size="11"/>
            </div>
            <div class="pure-control-group" align="center">
                <button type="button" class="pure-button pure-button-primary" onclick="updateEquipment()">修改</button>
                <button type="reset" class="pure-button pure-button-primary">取消</button>
                <button type="button" class="pure-button pure-button-primary"onclick="back()">返回</button>
            </div>
        </fieldset>
    </form>
</body>
</html>