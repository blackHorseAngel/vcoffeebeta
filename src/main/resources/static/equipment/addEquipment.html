<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新增设备页面</title>
    <link rel="stylesheet" type="text/css" href="/css/pure-min.css"/>
    <script type="text/javascript">
        /**
         * 页面初始化，获取全部公司名称下拉列表
         */
    window.onload = function() {
        const url = "/vcoffee/company/findAllCompanyNames"
        const xhr = new XMLHttpRequest();
        xhr.open("POST",url,true);
        xhr.setRequestHeader("content-Type","application/json");
        xhr.onload = function () {
            let res = JSON.parse(xhr.responseText);
            if(res.code === 1000){
                alert(res.message);
                let companyNameSelector = document.getElementById("companyId");
                for(let i = 0 ; i < res.data.length ; i++){
                    let companyNameOption = document.createElement("option");
                    companyNameOption.value = res.data[i].id;
                    companyNameOption.innerHTML = res.data[i].companyName;
                    companyNameSelector.appendChild(companyNameOption);
                }
            }else{
                console.error("设备新增页面中，查询公司名称报错," + res.message);
                window.location.href = "/error/error.html";
            }
        };
        xhr.onerror = function () {
            console.error("设备新增页面中，查询公司名称报错,",JSON.parse(xhr.responseText).message);
            window.location.href = "/error/error.html";
        };
        xhr.send();
    }

        /**
         * 点击新增按钮，新增设备信息
         */
    function insertEquipment() {
            const serialNumber = document.getElementById("serialNumber").value;
            const equipmentName = document.getElementById("equipmentName").value;
            const isUsed = getIsUsedRadioValue();
            const companyId = document.getElementById("companyId").value;
            const attendantName = document.getElementById("attendantName").value;
            const attendantTelephoneNumber = document.getElementById("attendantTelephoneNumber").value;
            const params = {
              "serialNumber":serialNumber,
              "equipmentName":equipmentName,
              "isUsed":isUsed,
              "companyId":companyId,
              "attendantName":attendantName,
              "attendantTelephoneNumber":attendantTelephoneNumber
            };
            const url = "/vcoffee/equipment/insertEquipment";
            const xhr = new XMLHttpRequest();
            xhr.open("POST",url,true);
            xhr.setRequestHeader("content-Type","application/json");
            xhr.onload = function () {
                let res = JSON.parse(xhr.responseText);
                if(res.code === 1000){
                    alert(res.message);
                    window.location.href = "/equipment/queryEquipment.html";
                }else{
                    console.error("新增设备失败：" + res.message);
                    window.location.href = "/error/error.html";
                }
            };
            xhr.onerror = function(e2){
              console.error("新增设备失败：" + JSON.parse(xhr.responseText));
              window.location.href = "/error/error/.html";
            };
            xhr.send(JSON.stringify(params));
        }
        /**
         * 获取单选框的值
         * @returns {*}
         */
        function getIsUsedRadioValue(){
            let isUsed = document.getElementById("isUsed");
            let isNotUsed = document.getElementById("isNotUsed");
            let isUsedValue = null;
            let isNotUsedValue = null;
            if(isUsed.checked === true){
                isUsedValue = isUsed.value;
                return isUsedValue;
            }
            if(isNotUsed.checked === true){
                isNotUsedValue = isNotUsed.value;
                return isNotUsedValue;
            }
        }
        /**
         * 返回主页面
         */
        function  back() {
            window.location.href = "/home/home.html";
        }
    </script>
</head>
<body background="/picture/welcome.jpg" style="background-repeat: no-repeat;background-size: 100% 100%;background-attachment: fixed;">
    <form class="pure-form pure-form-aligned" method="post">
        <fieldset>
            <div class="pure-controls">
                <legend align="center">新增设备</legend>
            </div>
            <div class="pure-control-group" align="center">
                <label for="serialNumber">设备序列号&nbsp</label>
                <input type="text" id="serialNumber" name="serialNumber"  placeholder="设备序列号"/>
            </div>
            <div class="pure-control-group" align="center">
                <label for="equipmentName">设备的名称</label>
                <input type="text" id="equipmentName" name="equipment"  placeholder="设备名称"/>
            </div>
            <div class="pure-control-group" align="center">
                <label for="isUsed">是否投入使用</label>
                <input type="radio" id="isNotUsed" name="isUsed" value="0" checked/>未使用&nbsp&nbsp
                <input type="radio" id="isUsed" name="isUsed" value="1" >投入使用
            </div>
            <div class="pure-control-group" align="center">
                <label for="companyId">设备所属公司&nbsp&nbsp</label>
                <select id="companyId"  name="companyId" autofocus="autofocus">

                </select>
            </div>
            <div class="pure-control-group" align="center">
                <label for="attendantName">维护人姓名&nbsp&nbsp</label>
                <input type="text" id="attendantName" name="attendantName"  placeholder="维护人姓名"/>
            </div>
            <div class="pure-control-group" align="center">
                <label for="attendantTelephoneNumber">维护人电话</label>
                <input type="number" id="attendantTelephoneNumber" name="attendantTelephoneNumber"  placeholder="维护人联系方式"/>
            </div>
            <div class="pure-control-group" align="center">
                <button type="button" class="pure-button pure-button-primary" onclick="insertEquipment()">新增</button>
                <button type="reset" class="pure-button pure-button-primary">取消</button>
                <button type="button" class="pure-button pure-button-primary" onclick="back()">返回</button>
            </div>
        </fieldset>
    </form>
</body>
</html>