<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>查询公司页面</title>
    <link rel="stylesheet" type="text/css" href="/css/pure-min.css"/>
    <!-- html嵌入另一个页面目前存在问题 -->
    <!--<link rel="import" href="/home/home.html" id="homePage">-->
   <script type="text/javascript">
        // document.write(homePage.import.body.innerHTML);

    function forwardAddCompany() {
      window.location.href = "/company/addCompany.html";
    }

    window.onload = function () {
            const  xhr = new XMLHttpRequest();
            const  url = "/vcoffee/findAllCompany";
            const  params = {};
            xhr.open("POST",url,true);
            xhr.onload = function (e1) {
                let res = JSON.parse(xhr.responseText);
                if(res.code === 1000){
                    for (let i = 0;i < res.data.length;i++){
                        let rowElement = document.createElement("tr");
                        let idCell = document.createElement("td");
                        idCell.innerHTML = res.data[i].id;
                        rowElement.appendChild(idCell);
                        let nameCell = document.createElement("td");
                        nameCell.innerHTML = res.data[i].companyName;
                        rowElement.appendChild(nameCell);
                        let nickCell = document.createElement("td");
                        nickCell.innerHTML = res.data[i].companyNickName;
                        rowElement.appendChild(nickCell);
                        let phoneCell = document.createElement("td");
                        phoneCell.innerHTML = res.data[i].companyPhoneNumber;
                        rowElement.appendChild(phoneCell);
                        let addressCell = document.createElement("td");
                        addressCell.innerHTML = res.data[i].companyAddress;
                        let operateCell = document.createElement("td");
                        let btnUpdate = document.createElement("button");
                        btnUpdate.setAttribute("type","button");
                        btnUpdate.setAttribute("value","修改");
                        btnUpdate.setAttribute("id",res.data[i].id);
                        btnUpdate.addEventListener("click",toUpdateCompany);
                        // btnUpdate.onclick = toUpdateCompany();
                        btnUpdate.innerText = "修改";
                        operateCell.appendChild(btnUpdate);

                        let btnDel = document.createElement("button");
                        btnDel.setAttribute("type","button");
                        btnDel.setAttribute("value","删除");
                        btnDel.setAttribute("id",res.data[i].id);
                        btnDel.addEventListener("click",deleteCompany);
                        // btnDel.onclick = deleteCompany();
                        btnDel.innerText = "删除";
                        operateCell.appendChild(btnDel);

                        operateCell.appendChild(btnDel);
                        rowElement.appendChild(addressCell);
                        rowElement.appendChild(operateCell);

                        let tbody = document.getElementById("companyTbody");
                        tbody.appendChild(rowElement);
                    }
                }
            };
            xhr.onerror = function(e){
                console.error(JSON.parse(xhr.responseText).message);
                window.location.href = "/error/error.html";
            };
            xhr.send(JSON.stringify(params));
        };

        function toUpdateCompany(){
            window.location.href = "/company/updateCompany.html?id="+this.id;
    }

           function deleteCompany() {


              const url = "/vcoffee/deleteCompany";
              const xhr = new XMLHttpRequest();
              const delParam = {
                "id":this.id
              };
              xhr.open("POST",url,true);
              xhr.setRequestHeader("content-Type","application/json");
              xhr.onload = function (delSuccessData) {
                  let res = JSON.parse(xhr.responseText);
                  if(res.code === 1000){
                    alert(res.message);
                    window.location.href = "/company/queryCompany.html";
                  }else{
                      console.log(JSON.parse(xhr.responseText).message);
                      window.location.href = "/error/error.html";
                  }
              };
              xhr.onerror = function (delErrorData) {
                 console.log(JSON.parse(xhr.responseText).message);
                 window.location.href = "/error/error.html";
              };
              xhr.send(JSON.stringify(delParam));
           }

        function queryCompany() {
            const companyName = document.getElementById("companyName").value;
            const companyPhoneNumber = document.getElementById("companyPhoneNumber").value;
            const companyAddress = document.getElementById("companyAddress").value;
            const params = {
                "companyName":companyName,
                "companyPhoneNumber":companyPhoneNumber,
                "companyAddress":companyAddress,
                "page":{
                    "currentPage":1,
                    "limit":10
                }
            };
            const url = "/vcoffee/queryCompany";
            const xhr = new XMLHttpRequest();
            xhr.open("POST",url,true);
            xhr.onload = function(e1){
                let res = JSON.parse(xhr.responseText);
                if(res.code === 1000){
                    alert(res.message);
                }else{
                    alert(res.message);
                }

            };
            xhr.onerror = function(e2){
                console.error("查询公司信息失败："+JSON.parse(xhr.responseText));
                window.location.href = "/error/error.html";
            };
            xhr.send(JSON.stringify(params));
        }
        function back() {
          window.location.href = "/home/home.html";
        }
    </script>
</head>
<body background="/picture/welcome.jpg" style="background-repeat: no-repeat;background-size: 100% 100%;background-attachment: fixed;">
<form class="pure-form" method="post">
    <fieldset>
        <input type="text" id="companyName" name="companyName" placeholder="公司名称"/>
        <input type="text" id="companyPhoneNumber" name="companyPhoneNumber" placeholder="公司电话"/>
        <input type="text" id="companyAddress" name="companyAddress" placeholder="公司地址"/>
        <button type="button" class="pure-button pure-button-primary" onclick="queryCompany()">查询</button>
        <button type="reset" class="pure-button pure-button-primary">取消</button>
        <button type="button" class="pure-button pure-button-primary" onclick="forwardAddCompany()">新增</button>
        <button type="button" class="pure-button pure-button-primary" onclick="back()">返回</button>
    </fieldset>
</form>
<table class="pure-table pure-table-bordered" align="center">
    <thead align="center">
        <tr>
           <td>序号</td>
           <td>公司名称</td>
           <td>公司简称</td>
           <td>公司电话</td>
           <td>公司地址</td>
           <td>操作</td>
        </tr>
    </thead>
    <tbody id="companyTbody" align="center">

    </tbody>
</table>
</body>
</html>