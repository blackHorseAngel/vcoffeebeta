<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>改密码页面</title>
    <link rel="stylesheet" type="text/css" href="/css/pure-min.css"/>
    <script type="text/javascript">
    /**
     * 初始化获取用户名和密码
     */
    window.onload = function () {
       const url = "/vcoffee/user/findUserById";
       const xhr = new XMLHttpRequest();
       xhr.open("POST",url,true);
       xhr.setRequestHeader("content-Type","application/json");
       xhr.onload = function () {
         let res = JSON.parse(xhr.responseText);
         if(res.code === 1000){
           console.log(res.message);
           let username = document.getElementById("username");
           username.value = res.data.username;
           let password = document.getElementById("password");
           password.value = res.data.password;
         }else{
             console.error("查询用户名报错，" + res.message);
             window.location.href = "/error/error.html";
         }
       };
       xhr.onerror = function () {
           console.error("查询用户名报错，" + JSON.parse(xhr.responseText).message);
           window.location.href = "/error/error.html";
       };
       xhr.send();
    };

    /**
     * 用户更新新密码
     */
    function updatePassword() {
       const newPassword = document.getElementById("newPassword").value;
       const confirmPassword = document.getElementById("confirmPassword").value;
       const updateParams = {
         "newPassword":newPassword,
         "confirmPassword":confirmPassword
       };
       const url = "/vcoffee/updatePassword";
       const xhr = new XMLHttpRequest();
       xhr.open("POST",url,true);
       xhr.setRequestHeader("content-Type","application/json");
       xhr.onload = function () {
          let res = JSON.parse(xhr.responseText);
          if(res.code === 1000){
              console.log(res.message);
              window.location.href = "/login/login.html";
          }else{
              console.error("更新密码报错" + res.message);
              window.location.href = "/error/error.html";
          }
       };
       xhr.onerror = function () {
           console.error("更新密码报错" + res.message);
           window.location.href = "/error/error.html";
       };
       xhr.send(JSON.stringify(updateParams));
    }

    /**
     * 返回主页面
     */
     function back() {
        window.location.href = "/error/error.html";
     }
    </script>
</head>
<body background="/picture/coffee.jpg" style="background-repeat: no-repeat;background-size: 100% 100%;background-attachment: fixed;">
   <form class="pure-form pure-form-aligned" method="post">
       <fieldset>
           <div class="pure-controls">
               <legend align="center">修改密码</legend>
           </div>
           <div class="pure-control-group" align="center">
               <label for="username">用户姓名</label>
               <input type="text" id="username" name="username" placeholder="用户姓名" readonly="readonly"/>
           </div>
           <div class="pure-control-group" align="center">
               <label for="password">用户密码</label>
               <input type="password" id="password" name="password" placeholder="用户密码" readonly="readonly"/>
           </div>
           <div class="pure-control-group" align="center">
               <label for="newPassword">用户新密码</label>
               <input type="password" id="newPassword" name="newPassword" placeholder="用户新密码" min="6" max="20" autocomplete="off"/>
           </div>
           <div class="pure-control-group" align="center">
               <label for="confirmPassword">确认新密码</label>
               <input type="password" id="confirmPassword" name="confirmPassword" placeholder="确认新密码" min="6" max="20" autocomplete="off"/>
           </div>
           <div class="pure-control-group" align="center">
               <button type="button" class="pure-button pure-button-primary" onclick="updatePassword()">修改密码</button>
               <button type="reset" class="pure-button pure-button-primary">取消</button>
               <button type="button" class="pure-button pure-button-primary" onclick="back()">返回</button>
           </div>
       </fieldset>
   </form>
</body>
</html>